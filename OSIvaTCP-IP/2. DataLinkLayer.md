# Tầng Liên Kết dữ liệu
MỤC LỤC
- [Tầng Liên Kết dữ liệu](#tầng-liên-kết-dữ-liệu)
  - [1. Khái niệm tổng quát](#1-khái-niệm-tổng-quát)
  - [2. Chức năng và nhiệm vụ](#2-chức-năng-và-nhiệm-vụ)
    - [2.1 Đóng gói dữ liệu(Frame) và truy cập đường truyền(Link Access)](#21-đóng-gói-dữ-liệuframe-và-truy-cập-đường-truyềnlink-access)
    - [2.2 Dịch vụ truyền tin cậy:](#22-dịch-vụ-truyền-tin-cậy)
    - [2.3 Kiểm soát lưu lượng](#23-kiểm-soát-lưu-lượng)
    - [2.4 Phát hiện lỗi và sửa lỗi](#24-phát-hiện-lỗi-và-sửa-lỗi)
    - [2.5 Địa chỉ hóa](#25-địa-chỉ-hóa)
  - [3. Các lớp con: LLC và MAC](#3-các-lớp-con-llc-và-mac)
    - [3.1 LLC(Logical Link Control)](#31-llclogical-link-control)
    - [3.2 MAC(Media Access Control)](#32-macmedia-access-control)
  - [4. Công nghệ Ethernet](#4-công-nghệ-ethernet)
  - [5. Một số giao thức hoạt động ở tầng DataLink](#5-một-số-giao-thức-hoạt-động-ở-tầng-datalink)
    - [5.1 Giao thức PPP:](#51-giao-thức-ppp)
    - [5.2 Giao thức ARP(Address Resolution Protocol)](#52-giao-thức-arpaddress-resolution-protocol)
    - [5.3. RARP](#53-rarp)
## 1. Khái niệm tổng quát
- Là tầng thứ 2 trong mô hình OSI
- Có nhiệm vụ thiết lập, duy trì hoặc hủy bỏ các mối liên kết
- Kiểm soát lưu lượng cũng như lỗi phát sinh trong quá trình truyền tải dữ liệu

## 2. Chức năng và nhiệm vụ
### 2.1 Đóng gói dữ liệu(Frame) và truy cập đường truyền(Link Access)
- Đóng gói dữ liệu:
    - Cũng như các tầng khác, tầng DataLink cũng thực hiện việc đóng gói dữ liệu bằng cách thêm các header ở tầng của mình vào gói dữ liệu nhận được từ tầng Network và gói dữ liệu ở tầng DataLink được chuyển thành các *Frame*. Điểm khác biệt ở đây là *Frame* có cả trường tiêu đề đầu và cuối(header and trailer)
    - ![Alt text](/Anh/image.png)
- Truy cập đường truyền:

Bao gồm 4 giao thức:
- Giao thức phân chia theo thời gian(TDM-Time Division Multiplexing)
    - Là phương thức truyền và nhận nhiều tín hiệu độc lập qua 1 đường tín hiệu chung
    - Bằng các chuyển mạch đồng bộ ở mỗi đầu của đường truyền để mỗi tín hiệu chiếm 1 phần thời gian và thứ tự xác định trong mỗi chu kì truyền tín hiệu
    - TDM thường được sử dụng khi có 1 lượng lớn dữ liệu cần được truyền qua 1 kênh truyền thông chung   
    - Trong thực tế, TDM được sử dụng trong các hệ thống điện thoại để truyền nhiều cuộc gọi điện thoại qua các đường truyền có dung lượng/thời lượng cao
- Giao thức phân chia theo tần số(FDM-Frequency Division Multiplexing):
    - Là 1 kỹ thuật mà băng thông tổng được phân chia thành một chuỗi liên tiếp các dải tần số phụ không trùng lặp, mỗi dải tần số có tín hiệu riêng biệt
    - FDM thường được sử dụng khi băng thông của đường truyền > băng thông tổ hợp của tín hiệu truyền
    - Trong thực tế, FDM được sử dụng trong các hệ thống truyền hình cáp, trong đó có nhiều kênh truyền hình được thực hiện đồng thời trên 1 cáp
- Giao thức phân chia theo mã(CDM-Code Division Multiplexing): 
    - Còn được gọi là đa truy nhập phân chia theo mã(CDMA), là một kỹ thuật mà nhiều tín hiệu dữ liệu được kết hợp để truyền đồng thời trên cùng 1 dải tần số chung
    - Tuy không phổ biến như TDM và FDM, nhưng CDM vẫn được sử dụng trong 1 số ứng dụng nhất định. Một ví dụ điển hình là trong các hệ thống điện thoại di động 3G-nơi mà nhiều cuộc gọi có thể được thực hiện đồng thời trên cùng 1 tần số bằng cách sử dụng các mã khác nhau cho mỗi cuộc gọi
- Giao thức truy cập ngẫu nhiên(RAP-Random Access Protocol): 
    - Giao thức truy cập ngẫu nhiên là một phương pháp cho phép các thiết bị truy cập vào mạng một cách ngẫu nhiên và độc lập. Các thiết bị sẽ cạnh tranh với nhau để truy cập vào mạng
    - Một số giao thức phổ biến bao gồm: ALOHA, CSMA/CD, CSMA/CA

### 2.2 Dịch vụ truyền tin cậy:
- Giao thức tầng liên kết dữ liệu đảm bảo truyền chính xác gói dữ liệu đến đúng nơi cần đến trên một đường truyền. 
- Dịch vụ này thường được sử dụng trên các đường truyền có tỉ lệ lỗi cao, ví dụ như dường truyền không dây

### 2.3 Kiểm soát lưu lượng
- Có khả năng kiểm soát lưu lượng dữ liệu một cách hiệu quả. 
- Đảm bảo rằng dữ liệu được truyền đi một cách mượt mà, không bị tắc nghẽn và không gây xung đột khi 2 thông điệp cùng truyền trên một đường dây. 

### 2.4 Phát hiện lỗi và sửa lỗi
- Phát hiện lỗi: Nút nhận có thể nhận bit 0 trong khi phía gửi gửi đi bit 1 hoặc ngược lại. Nguyên nhân khiến bit bị lỗi có thể do tín hiệu bị suy hao trong quá trình truyền hay gặp nhiều điện từ --> Nhiều giao thức tầng DataLink đã cung cấp cơ chế phát hiện lỗi, được thực hiện bằng cách phía gửi sẽ thiết lập 1 số bit phát hiện lỗi trong *Frame* và phía nhận sẽ thực hiện việc kiểm tra lỗi
- Sửa lỗi: Cũng giống như cách nó phát hiện lỗi, tuy nhiên ở đây, phía nhận có thể xác định chính xác vị trí lỗi và tiến hành sửa(thực hiện yêu cầu truyền lại chẳng hạn)

### 2.5 Địa chỉ hóa
- Như ta đã biết, mỗi thiết bị tham gia vào mạng đều cần phải có địa chỉ để có thể truyền và nhận dữ liệu 1 cách chĩnh xác. Nếu như địa chỉ IP dùng để xác định vị trí các thiết bị trong mạng thì có 1 loại địa chỉ dùng để nhận dạng các thiết bị đó mang tên MAC(Media Access Control) và tầng Datalink thực hiện việc gán các địa chỉ này. Thường sẽ gắn cho các card mạng
- Như các sản phẩm không cần kết nối ra internet như: chuột, bàn phím thì địa chỉ MAC sẽ được các nhà sản xuất gắn cố định vào sản phẩm của họ

## 3. Các lớp con: LLC và MAC
### 3.1 LLC(Logical Link Control)
- Lớp con LLC này có nhiệm vụ chính là điều khiển việc truyền tải dữ liệu giữa các thiết bị trong mạng
- Cụ thể các chức năng: 
    + Ghép nhiều giao thức để truyền qua tầng MAC khi truyền và phân kênh khi chúng nhận dữ liệu
    + Điều khiển lưu lượng: Đảm bảo người gửi không gửi quá nhiều
    + Phát hiện và truyền lại các gói tin bị bỏ: Nếu 1 gói tin bị mất trong lúc truyền, LLC sẽ gửi yêu cầu truyền lại
- VD: Khi kết nối máy tính với 1 mạng Ethernet, LLC sẽ là tầng con phía trên của tầng DataLink, giúp điều khiển việc truyền tải dữ liệu giữa máy tính và các thiết bị khác trong mạng

### 3.2 MAC(Media Access Control)
- là 1 số nhận dạng mà thiết bị mạng sử dụng để nhận dạng chính nó trên mạng --> nó là duy nhất và không có trường hợp 2 thiết bị có chung 1 địa chỉ MAC
- Được tạo thành từ 1 dãy số thập lục phân, bao gồm 12 ký tự, chứa cả chữ và số
- Được chia làm 2 phần: 
    + 6 ký tự đầu xác định nhà sản xuất
    + 6 ký tự cuối cùng đại diện cho các mạng được gắn bởi các nhà sản xuất
- Được định dạng theo nhiều cách:
    + Trên windows: Có dấu "-" ở giữa :  FC-AB-90-35-D5-5C
    + Trên hệ thống của Apple/Linux: Có dấu ":" ở giữa:  00:BD:23:F5:D5:G8
    + Trên CISCO: 4 bộ chữ số được phân tách bằng ".": 0004.23F5.D5G8
- Mục đích của địa chỉ MAC để giúp các địa chỉ MAC giao tiếp với nhau
    + Một máy tính nếu muốn giao tiếp được với nhau cần cả địa chỉ IP và MAC mới có thể giao tiếp.
- VD: Trong 1 khu phố thì địa chỉ IP cho biết vị trí ngôi nhà còn địa chỉ MAC cho biết ai sống trong ngôi nhà đó
- Cách tìm địa chỉ MAC trên máy tính Windows:
    - Vào cmd và nhập lệnh `ipconfig /all`
    ![Alt text](/Anh/image-1.png)
- Cách tìm địa chỉ MAC trên Ubuntu(Linux):
    - Vào Terminal nhập lệnh `ip a`
    - ![Alt text](/Anh/image-2.png)

## 4. Công nghệ Ethernet
- Là 1 công nghệ mạng máy tính phổ biến được sử dụng rộng rãi trong các mạng LAN(Local Area Network). Ethernet cho phép các thiết bị trong mạng giao tiếp với nhau thông qua một bộ quy tắc hoặc ngôn ngữ mạng chung
- Dữ liệu khi được truyền qua Ethernet được chia thành nhiều mảnh nhỏ gọi là các *Frames*. Mỗi *Frames* bao gồm:
    + Địa chỉ nguồn
    + Địa chỉ đích
    + Dữ liệu
    + Kiểm tra lỗi
- Ethernet càng ngày càng phát triển theo thời gian. Tốc độ truyền dữ liệu tăng từ 2,9Mbit/s lên tới 100GBit/s. Các phiên bản Ethernet mới hơn sử dụng các xoắn đôi và các liên kết sợi quang học(cáp quang)
- Ưu điểm:
    + Truyền nhanh
    + Chi phí thấp
    + Dễ sử dụng
    + Có thể kết nối đa mạng
- Nhược điểm:
    + Khoảng cách truyền dẫn có hạn: 
        + 185m trên cáp đồng trục 
        + 100m trên cáp xoắn đôi
    + Có thể bị nhiễu bởi các tín hiệu khác trong môi trường
    + Dữ liệu không được mã hóa --> có thể bị đánh cắp hoặc theo dõi
    + Mạng Ethernet lớn --> việc quản lý và bảo trì không dễ dàng
- Trong thực tế, khi ta kết nối máy tính cá nhân với mạng internet tại trường học, cơ quan hoặc tại nhà qua cáp quang mạng nghĩa là ta đang sử dụng công nghệ Ethernet

## 5. Một số giao thức hoạt động ở tầng DataLink
### 5.1 Giao thức PPP:
- PPP(Point to Point Protocol): là một giao thức phổ biến trong mạng WAN. Được cấu thành từ 2 thành phần chính:
    + LCP(Link Control Protocol): Dùng để thiết lập, đình hình cấu hình và kiểm tra kết nối liên kết dữ liệu. Linh hoạt trong việc xử lý các kích cỡ khác nhau của các gói. Nếu phát hiện 1 liên kết lỗi, lập tức hủy kết nối. Nói chung LCP giúp thiết lập các tiêu chuẩn cho việc truyền dữ liệu
    + NCP(Network Control Protocol): làm nhiệm vụ thiết lập, điều chỉnh cấu hình và hủy bỏ việc truyền dữ liệu của các giao thức của lớp network như: IP, IPX, AppleTalk and DECnet
- Có 5 pha trong quá trình thiết lập kết nối PPP:
    - Dead: kết nối chưa họat động
    - Establish: khởi tạo LCP và sau khi đã nhận được bản tin Configure ACK liên kết sẽ chuyển sang pha sau: authentication
    - Authenticate: có thể lựa chọn một trong hai cơ chế PAP hay CHAP.
    - Network: trong pha này, cơ chế truyền dữ liệu cho các giao thức lớp Network được hỗ trợ sẽ được thiết lập và việc truyền dữ liệu sẽ bắt đầu.
    - Terminate: Hủy kết nối

### 5.2 Giao thức ARP(Address Resolution Protocol)
- Là 1 giao thức phân giải địa chỉ. Hiểu đơn giản thì nó sẽ nhận địa chỉ IP để tìm ra địa chỉ MAC
- ![Alt text](/Anh/image-3.png)
- Đơn giản về cách hoạt động: VD máy tính A muốn giao tiếp với máy tính D
- ![Alt text](/Anh/image-4.png)
- Máy tính A đã biết IP của máy tính D
- Lúc này A sẽ gửi 1 gói tin ARP Broadcast có kèm IP máy D đến tất cả các thiết bị trong mạng(B, C, D)
- Tất cả các thiết bị B, C, D đều nhận được gói tin này và chỉ có máy D có địa chỉ IP trùng với IP trong gói tin ARP sẽ thực hiện trả lời. 
- Máy D sau khi nhận được gói tin sẽ thực hiện truyền lại 1 gói tin có kèm địa chỉ MAC của mình
- Máy A khi đã biết cả IP và MAC của máy D thì lúc này 2 máy A và D có thể kết nối để giao tiếp với nhau
- Ví dụ sử dụng WireShark để bắt và phân tích gói tin ARP
- ![Alt text](/Anh/image-5.png)
- Ở phần Info, ta có thể hiểu đơn giản gói tin này muốn biết máy nào đang dùng IP: **192.168.68.58**. Và nếu có thông tin thì hãy thông báo tới GateWay với IP:**192.168.68.1**
- Gói tin này sẽ thực hiện gửi đến tất cả các máy, mỗi máy chỉ nhận 1 lần. Và nếu không có phản hồi từ máy nào nghĩa là không tồn tại máy sử dụng IP đấy
- Phân tích gói tin:
- ![Alt text](/Anh/image-6.png)
- Bao gồm: 
    + Công nghệ: Ethernet 
    + Loại giao thức: IPv4
    + Opcode: request(1 loại yêu cầu)
    + MAC máy gửi: 74:4d:28:a8:fb:57
    + IP máy gửi: 192.168.68.1
    + MAC tìm kiếm: Chưa rõ
    + IP tìm kiếm: 192.168.68.58

### 5.3. RARP 
- Hiểu đơn giản nó chỉ là giao thức đảo ngược của giao thức ARP, nó sẽ nhận đầu vào là địa chỉ MAC và yêu cầu trả về sẽ là địa chỉ IP






